import asyncio
import os
from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.filters import CommandStart, StateFilter
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton, CallbackQuery
from aiogram.utils.keyboard import InlineKeyboardBuilder
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext # –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM
from dotenv import load_dotenv  # –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ FSM
from auth import cmd_start, process_name, process_phone, Form  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ auth.py
from start import start


load_dotenv()
TOKEN = os.getenv("BOT_TOKEN")
bot = Bot(token=TOKEN)
dp = Dispatcher()


# –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
dp.message.register(cmd_start, CommandStart())
dp.message.register(process_name, StateFilter(Form.name))
dp.message.register(process_phone, StateFilter(Form.phone))

# üëá —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å–ø–∏—Å–∫–æ–º —é—Ä–∏—Å—Ç–æ–≤
lawyers_schedule = {
    "–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–±–ª–∞—Å—Ç–∏ —Å–µ–º–µ–π–Ω–æ–≥–æ, —Ç—Ä—É–¥–æ–≤–æ–≥–æ, –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–≥–æ –∏ –ø—Ä–æ—á–µ–≥–æ –ø—Ä–∞–≤–∞": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–Æ—Ä–∏—Å—Ç-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç",
            "name": "–ò–≤–∞–Ω–æ–≤–∞ –ê.–ê.",
            "time": "–ü–Ω 10:00, –ü–Ω 13:00, –°—Ä 14:00", 
            # "time": "5 –ú–∞—è –ü–Ω 10:00, 5 –ú–∞—è –ü–Ω 13:00, 7 –ú–∞—è –°—Ä 14:00", 
            "address": "–≥. –ß–µ–±–æ–∫—Å–∞—Ä—ã, —É–ª. –ì–∞–≥–∞—Ä–∏–Ω–∞, –¥. 12, –ø–æ–¥—ä–µ–∑–¥ 2"
        },
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–Æ—Ä–∏—Å—Ç-–∞–Ω–∞–ª–∏—Ç–∏–∫",
            "name": "–ì—Ä–∏–≥–æ—Ä—å–µ–≤ –í.–ò.",
            "time": "9 –ú–∞—è –ü—Ç 13:00, 9 –ú–∞—è –ü—Ç 15:00",
            "address": "–ü—Ä–æ—Å–ø–µ–∫—Ç –ú–∏—Ä–∞, 3, –ø–æ–¥—ä–µ–∑–¥ 1"
        }
    ],
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–æ–¥–∞—á–∞ –∏—Å–∫–æ–≤, –ø—Ä–µ—Ç–µ–Ω–∑–∏–π, –∂–∞–ª–æ–±": [
        {
            "institution": "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω–Ω—ã–π —Å—É–¥",
            "role": "–Æ—Ä–∏—Å—Ç –ø–æ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–º –¥–µ–ª–∞–º",
            "name": "–°–º–∏—Ä–Ω–æ–≤–∞ –õ.–í.",
            "time": "6 –ú–∞—è –í—Ç 09:00, 6 –ú–∞—è –í—Ç 14:45, 8 –ú–∞—è –ß—Ç 10:00, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –õ–µ–Ω–∏–Ω–∞, 45, –ø–æ–¥—ä–µ–∑–¥ 3"
        },
        {
            "institution": "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω–Ω—ã–π —Å—É–¥",
            "role": "–Æ—Ä–∏—Å—Ç –ø–æ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–º –¥–µ–ª–∞–º",
            "name": "–ê–ª–µ–∫—Å–µ–µ–≤ –ò.–ú.",
            "time": "16 –ú–∞—è –°—Ä 09:00, 17 –ú–∞—è –ß—Ç 10:00, 18 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        },
        {
            "institution": "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω–Ω—ã–π —Å—É–¥",
            "role": "–Æ—Ä–∏—Å—Ç –ø–æ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏–º –¥–µ–ª–∞–º",
            "name": "–î–µ–º–∏–¥–æ–≤–∞ –°.–ù",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ],
    "–°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ —Å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–Æ—Ä–∏—Å—Ç –ø–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏",
            "name": "–ö—É–∑–Ω–µ—Ü–æ–≤–∞ –ò.–ì.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ],
    "–†–µ—à–µ–Ω–∏–µ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–ø–æ—Ä–æ–≤ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–ù–æ—Ç–∞—Ä–∏—É—Å",
            "name": "–ú–µ–ª—å–Ω–∏–∫–æ–≤–∞ –¢.–î.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        },
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–Æ—Ä–∏—Å—Ç –ø–æ –∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–ø–æ—Ä–∞–º",
            "name": "–û—Ä–ª–æ–≤ –ê.–°.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        },
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–Æ—Ä–∏—Å—Ç –ø–æ –ø—Ä–∞–≤–∞–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏",
            "name": "–ë—ã–∫–æ–≤ –¢.–û.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ],
    "–ó–∞—â–∏—Ç–∞ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–∞–≤": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–ù–æ—Ç–∞—Ä–∏—É—Å –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∞–≤—Ç–æ—Ä—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞",
            "name": "–ë—ã–∫–æ–≤ –¢.–û.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ],
    "–û–±–∂–∞–ª–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π —Å—É–¥–∞": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–ù–æ—Ç–∞—Ä–∏—É—Å –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∞–≤—Ç–æ—Ä—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞",
            "name": "–ë—ã–∫–æ–≤ –¢.–û.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ],
    "–í–æ–∑–≤—Ä–∞—Ç –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–ù–æ—Ç–∞—Ä–∏—É—Å –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∞–≤—Ç–æ—Ä—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞",
            "name": "–ë—ã–∫–æ–≤ –¢.–û.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ],
    "–ñ–∏–ª–∏—â–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–ù–æ—Ç–∞—Ä–∏—É—Å –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∞–≤—Ç–æ—Ä—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞",
            "name": "–ë—ã–∫–æ–≤ –¢.–û.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ],
    "–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –≤ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–ù–æ—Ç–∞—Ä–∏—É—Å –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∞–≤—Ç–æ—Ä—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞",
            "name": "–ë—ã–∫–æ–≤ –¢.–û.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ],
    "–ü—Ä–∞–≤–æ–≤–∞—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–ù–æ—Ç–∞—Ä–∏—É—Å –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∞–≤—Ç–æ—Ä—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞",
            "name": "–ë—ã–∫–æ–≤ –¢.–û.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ],
    "–ü–æ–º–æ—â—å –≤ —Å–ø–æ—Ä–∞—Ö —Å –±–∞–Ω–∫–∞–º–∏ –∏ –≤ –±–æ—Ä—å–±–µ —Å –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞–º–∏": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–ù–æ—Ç–∞—Ä–∏—É—Å –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∞–≤—Ç–æ—Ä—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞",
            "name": "–ë—ã–∫–æ–≤ –¢.–û.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ],
    "–ü–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–∞ –∏ –≤–∏–¥–∞ –Ω–∞ –∂–∏—Ç–µ–ª—å—Å—Ç–≤–æ": [
        {
            "institution": "–¶–µ–Ω—Ç—Ä –ø—Ä–∞–≤–æ–≤–æ–π –ø–æ–º–æ—â–∏ –õ–µ–Ω–∏–Ω—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞",
            "role": "–ù–æ—Ç–∞—Ä–∏—É—Å –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –∞–≤—Ç–æ—Ä—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞",
            "name": "–ë—ã–∫–æ–≤ –¢.–û.",
            "time": "5 –ú–∞—è –ü–Ω 09:00, 7 –ú–∞—è –°—Ä 10:15, 9 –ú–∞—è –ü—Ç 13:30",
            "address": "–£–ª–∏—Ü–∞ –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, 18, –ø–æ–¥—ä–µ–∑–¥ 5"
        }
    ]
}

# üëá –ú–µ–Ω—é —Å —Ä–∞–π–æ–Ω–∞–º–∏

# üëá –ú–µ–Ω—é —Å –≤–∏–¥–∞–º–∏ —é—Ä. –ø–æ–º–æ—â–∏
services_kb = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–±–ª–∞—Å—Ç–∏ —Å–µ–º–µ–π–Ω–æ–≥–æ, —Ç—Ä—É–¥–æ–≤–æ–≥–æ, –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–≥–æ –∏ –ø—Ä–æ—á–µ–≥–æ –ø—Ä–∞–≤–∞")],
        [KeyboardButton(text="–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ø–æ–¥–∞—á–∞ –∏—Å–∫–æ–≤, –ø—Ä–µ—Ç–µ–Ω–∑–∏–π, –∂–∞–ª–æ–±")],
        [KeyboardButton(text="–°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ —Å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é")],
        [KeyboardButton(text="–†–µ—à–µ–Ω–∏–µ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–ø–æ—Ä–æ–≤ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞")],
        [KeyboardButton(text="–ó–∞—â–∏—Ç–∞ –∞–≤—Ç–æ—Ä—Å–∫–∏—Ö –ø—Ä–∞–≤")],
        [KeyboardButton(text="–û–±–∂–∞–ª–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π —Å—É–¥–∞")],
        [KeyboardButton(text="–í–æ–∑–≤—Ä–∞—Ç –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤")],
        [KeyboardButton(text="–ñ–∏–ª–∏—â–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã")],
        [KeyboardButton(text="–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –≤ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ")],
        [KeyboardButton(text="–ü—Ä–∞–≤–æ–≤–∞—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤")],
        [KeyboardButton(text="–ü–æ–º–æ—â—å –≤ —Å–ø–æ—Ä–∞—Ö —Å –±–∞–Ω–∫–∞–º–∏ –∏ –≤ –±–æ—Ä—å–±–µ —Å –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞–º–∏")],
        [KeyboardButton(text="–ü–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–∞ –∏ –≤–∏–¥–∞ –Ω–∞ –∂–∏—Ç–µ–ª—å—Å—Ç–≤–æ")]
    ],
    resize_keyboard=True
)

@dp.message(CommandStart())
# async def start(message: types.Message):
#     await message.answer("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –Æ—Ä–ü–æ–º–æ—â—å –ß–µ–±–æ–∫—Å–∞—Ä—ã ‚Äî —Å–µ—Ä–≤–∏—Å –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–∏—ë–º –≤ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω –í–∞—à –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å: ", reply_markup=district_kb)

@dp.message(lambda message: message.text in ["–ö–∞–ª–∏–Ω–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω", "–õ–µ–Ω–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω", "–ú–æ—Å–∫–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω", "–ó–∞–≤–æ–ª–∂—Å–∫–æ–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"])
async def district_selected(message: types.Message):
    await message.answer(
        f"–í–∞—à —Ä–∞–π–æ–Ω: {message.text}\n–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ —É—Å–ª—É–≥–∏:",
        reply_markup=services_kb
    )

from aiogram.utils.keyboard import InlineKeyboardBuilder

@dp.message(lambda message: message.text in lawyers_schedule)
async def service_selected(message: types.Message):
    selected_service = message.text
    schedule = lawyers_schedule[selected_service]

    institution = schedule[0].get("institution", "‚Äî")

    response = f"üè¨ <b>–£—á—Ä–µ–∂–¥–µ–Ω–∏–µ:</b> {institution}\n\n"
    response += f"<b>–í—ã –≤—ã–±—Ä–∞–ª–∏ —É—Å–ª—É–≥—É:</b>\n{selected_service}\n\n"
    response += "<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏:</b>\n"

    days_map = {
        "–ü–Ω": "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
        "–í—Ç": "–í—Ç–æ—Ä–Ω–∏–∫",
        "–°—Ä": "–°—Ä–µ–¥–∞",
        "–ß—Ç": "–ß–µ—Ç–≤–µ—Ä–≥",
        "–ü—Ç": "–ü—è—Ç–Ω–∏—Ü–∞",
        "–°–±": "–°—É–±–±–æ—Ç–∞",
        "–í—Å": "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"
    }

    builder = InlineKeyboardBuilder()  # –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –±–∏–ª–¥–µ—Ä–∞

    for lawyer in schedule:
        response += f"<b>–î–æ–ª–∂–Ω–æ—Å—Ç—å:</b> {lawyer.get('role', '‚Äî')}\n"
        response += f"üë©üèª‚Äçüíª <b>{lawyer['name']}</b>\n"
        response += f"<b>–í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏:</b>\n"

        time_slots = lawyer['time'].split(", ")
        for slot in time_slots:
            try:
                day_code, hour = slot.strip().split(" ")
                full_day = days_map.get(day_code, day_code)
                response += f" üïí {full_day} - {hour}\n"
                # match = re.match(r"(\d{1,2} [–ê-–Ø–∞-—è]+) (\d{1,2}:\d{2})", slot.strip())
                # if match:
                #     day_code = match.group(1)
                #     hour = match.group(2)
                #     full_day = days_map.get(day_code.split()[1], day_code.split()[1])  # –ü–µ—Ä–µ–≤–æ–¥–∏–º –¥–µ–Ω—å
                #     response += f" üïí {full_day} - {hour}\n"
            except ValueError:
                continue

        response += "\n"

        # –∫–Ω–æ–ø–∫–∞ —Å –∏–º–µ–Ω–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
        builder.button(text=lawyer["name"], callback_data=f"choose_lawyer:{lawyer['name']}")

    builder.adjust(1)  # –ø–æ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–µ –≤ —Ä—è–¥

    await message.answer(response, parse_mode="HTML")
    await message.answer("üë©üèª‚Äçüíª–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞:", reply_markup=builder.as_markup())

@dp.callback_query(lambda c: c.data.startswith("choose_lawyer:"))
async def choose_lawyer(callback: CallbackQuery):
    name = callback.data.split(":")[1]

    for lawyers in lawyers_schedule.values():
        for lawyer in lawyers:
            if lawyer["name"] == name:
                builder = InlineKeyboardBuilder()
                for slot in lawyer['time'].split(", "):
                    builder.button(text=slot, callback_data=f"choose_time:{name}:{slot}")
                await callback.message.answer(
                    f"üìå –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç: <b>{name}</b>\n–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –¥–ª—è –í–∞—Å –≤—Ä–µ–º—è:",
                    reply_markup=builder.as_markup(),
                    parse_mode="HTML"
                )
                await callback.answer()
                return
    await callback.answer("–Æ—Ä–∏—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω", show_alert=True)

@dp.callback_query(lambda c: c.data.startswith("choose_time:"))
async def choose_time(callback: CallbackQuery):
    _, name, time_slot = callback.data.split(":", 2)
    address = None  # –ó–¥–µ—Å—å –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –∞–¥—Ä–µ—Å —é—Ä–∏—Å—Ç–∞

    for service, lawyers in lawyers_schedule.items():
        for lawyer in lawyers:
            if lawyer['name'] == name:
                address = lawyer['address']
                break
        if address:
            break

    if address:
        await callback.message.answer(
            f"–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ã –∫ <b>{name}</b> –Ω–∞ {time_slot}. ‚úÖ\n\n"
            f"üìç –ê–¥—Ä–µ—Å: {address}",
            parse_mode="HTML"
        )
    else:
        await callback.message.answer("–û—à–∏–±–∫–∞‚ùå –Æ—Ä–∏—Å—Ç —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω.")
    await callback.answer("–ó–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞")
    


async def main():
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç...")
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())